<!DOCTYPE html>
<html>
<head>
		<title>Villages and Skyscrapers</title>

		<!--<meta name="referrer" content="origin" />-->
    <style>
	  
	</style>
    <!-- Load the P5.js library -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>

		<script src="Libraries\p5.clickable.js"></script>
		<script src="https://sdk.amazonaws.com/js/aws-sdk-2.1368.0.min.js" ></script>
		<script src="https://accounts.google.com/gsi/client" ></script>
		

		<script src="Libraries/p5.clickable.js"></script>
		<script src="https://sdk.amazonaws.com/js/aws-sdk-2.1368.0.min.js" defer></script>
		<script src="https://accounts.google.com/gsi/client" ></script>

		
	</head>


<body>

<div id="game-holder">

</div>
<!-- <div> <p xmlns:cc="http://creativecommons.org/ns#" >This work is licensed under <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">Attribution-NonCommercial-NoDerivatives 4.0 International</a></p></div> -->
<!--ksbgjkmnx-->


<script src = "Code/Villages_and_Skyscrapers.js"></script>
<script src = "Code/Resize.js"></script> 
<script src = "Code/playMenu.js"></script>
<script src = "Code/Game.js"></script>
<script src = "Code/buildConfirm.js"></script>
<script src = "Code/buildingInfo.js"></script>

<script src = "Code/awsTest.js" ></script>
<script>
      

	/**
	 * @description Function to decode Google OAuth token
	 * @param token: string
	 * @returns ticket object
	 */
 
	
	
	
	  
		function parseJwt (token) {
			try{
    var base64Url = token.split('.')[1];
    var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
			}catch{
            console.error("Nonexistent or invalid Google response ")


			}
			if(jsonPayload){
    return JSON.parse(jsonPayload);
			}
}
//https://stackoverflow.com/questions/38552003/how-to-decode-jwt-token-in-javascript-without-using-a-library
	</script>

<!--<script>hellop = function(a){if(a){let jwt = a.credentials;console.log(parseJwt(jwt))}}</script>-->

<script src = "Code/awsTest.js" ></script>
<script>
	var playerSave;
hellop = function(a){
	
	
	try{
	let jwt = a.credential;
	// jwt = "eyJhbGciOiJSUzI1NiIsImtpZCI6ImM5YWZkYTM2ODJlYmYwOWViMzA1NWMxYzRiZDM5Yjc1MWZiZjgxOTUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJuYmYiOjE2ODMyODMzNzksImF1ZCI6Ijk2NjM4MTYxNDM5MS1jYm5uazliZWdzOTczdGZqMjE2bm4zOTM4azVqcjN1ci5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjExNTc3MDg0NzMwMDg4NjYyNjgzNSIsImVtYWlsIjoibWFybXRrMTgxMUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiYXpwIjoiOTY2MzgxNjE0MzkxLWNibm5rOWJlZ3M5NzN0ZmoyMTZubjM5MzhrNWpyM3VyLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwibmFtZSI6Ik1hcnRpbiBUaG9tYXMiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUdObXl4YThiRDYxY2U0X09adWx2SGVHMVFqVDBZRkNIanlqUm5CRkpkaXExZz1zOTYtYyIsImdpdmVuX25hbWUiOiJNYXJ0aW4iLCJmYW1pbHlfbmFtZSI6IlRob21hcyIsImlhdCI6MTY4MzI4MzY3OSwiZXhwIjoxNjgzMjg3Mjc5LCJqdGkiOiI2YTlkYjBlMDA0OWViMWZkYTJkYTdhNWU5MzY0MGE3NWIyYjUwOTE0In0.LEkN4Fk037WwkJPMGjRNHXDbIvO38BlIDq8gzxrXUOeP0qdOIXKJ2WGzm4YtoNc7remoELc1s3BpXfgDtWt4qzGH9yw5lnO7wlnoujGuXz8Tq9O6bkTCyDcw4r25nZJ6ghX1xCGiSPNleokOGn-p-2q9H_0aJApDlrYIr6mWGfm6UDxt6xlF6Xo4IBKkxvun4Kl_KT8tzVP-FKageeHC2KhY0g0Mq0zAeH0WnNdtyAi8FpiK8pd2WrdKpGwr_thTF9S3RccMSkg7R2Gv53AkRPPW15dfDLqMz48RGuSdlw-cb7Fmn-9WywyGuwfbOrMHUfC7LGYoeByYifsEmOukPQ"
	console.log(a,"as a",parseJwt(jwt))
	s3Login(parseJwt(jwt))
	
	}catch(err){console.warn(err)}
   
        
}
 async function s3Login(parsedLoginInfo){
 
  
    //if(s3.getObject({Key:parsedLoginInfo.email},function(err,data){return data} )){
 await s3.getObject({Key:parsedLoginInfo.email+"/startingJWT"+".txt"},function(err,data){
	if(err){
   if(err.code === "NoSuchKey"){
	console.log(err);
	s3.putObject({Key:parsedLoginInfo.email+"/startingJWT.txt",Body:JSON.stringify(parsedLoginInfo)},function(err,data){print(err,data)})

   }else{console.log(err)}



	}else{
	 var href = this.request.httpRequest.endpoint.href;
    
    bucketUrl = href + "vandsbucket" + "/" +parsedLoginInfo.email+"/startingJWT"+".txt"
    let a = httpGet(bucketUrl,"text")

     
     a.then((successMessage) => {
        playerSave = successMessage
        console.log(JSON.parse(successMessage));
      })}
	});




 


}
</script>

<script>
	
	window.onload = function () {
		AWS.config.region = 'us-east-1'; // Region
AWS.config.credentials = new AWS.CognitoIdentityCredentials({
    IdentityPoolId: 'us-east-1:6f08b6e9-cb5a-4ac5-a418-096b814b92c9',
	Logins: { // optional tokens, used for authenticated login
      
        //'accounts.google.com': 'GOOGLETOKEN'
	}
});
	  google.accounts.id.initialize({
		client_id: '966381614391-cbnnk9begs973tfj216nn3938k5jr3ur.apps.googleusercontent.com',
		callback: hellop,
		auto_select: true
	  });
	  //google.accounts.id.prompt();

	  /*


	  google.accounts.id.prompt((notification) => {
		if(notification){
      console.log(notification,notification.getMomentType())
		}
    });

	*/
	
	google.accounts.id.renderButton(
            document.getElementById("game-holder"),
           { theme: "outline", size: "large",width:windowWidth,click_listener: hellop }  // customization attributes
        );
	};

	
	
//console.log(parseJwt(jwt))


	

	
  </script>
  <!--
<div id="g_id_onload"
data-client_id="966381614391-cbnnk9begs973tfj216nn3938k5jr3ur.apps.googleusercontent.com"
data-context="code"
data-login_uri="https://main.d1wj00apo7h0ow.amplifyapp.com/oauth2/idpresponse"
data-auto_select="true"
data-itp_support="true">
</div>

-->

<!-- This work is licensed under Attribution-NonCommercial-NoDerivatives 4.0 International-->
</body>
